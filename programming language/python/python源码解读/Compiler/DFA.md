# DFA

一下均出自 graminit.c 和graminit.h 

~~~c
/* A label of an arc */

typedef struct {
    int		 lb_type;
    char	*lb_str;
} label;

#define EMPTY 0		/* Label number 0 is by definition the empty label */

/* A list of labels */

typedef struct {
    int		 ll_nlabels;
    label	*ll_label;
} labellist;

/* An arc from one state to another */

typedef struct {
    short	a_lbl;		/* Label of this arc label 数组中的下标位置*/ 
    short	a_arrow;	/* State where this arc goes to */
} arc;

/* A state in a DFA */

typedef struct {
    int		 s_narcs;
    arc		*s_arc;		/* Array of arcs */
	
    //有什么作用
    /* Optional accelerators */
    int		 s_lower;	/* Lowest label index */
    int		 s_upper;	/* Highest label index */
    int		*s_accel;	/* Accelerator */
    int		 s_accept;	/* Nonzero for accepting state */
} state;

/* A DFA */

typedef struct {
    int		 d_type;	/* Non-terminal this represents */
    char	*d_name;	/* For printing */
    int		 d_initial;	/* Initial state */
    int		 d_nstates;
    state	*d_state;	/* Array of states */
    bitset	 d_first;
} dfa;

/* A grammar */

typedef struct {
    int		 g_ndfas;
    dfa		*g_dfa;		/* Array of DFAs */
    labellist	 g_ll;
    int		 g_start;	/* Start symbol of the grammar */
    int		 g_accel;	/* Set if accelerators present */
} grammar;

grammar _PyParser_Grammar = {
	84,
	dfas,
	{168, labels},
	256
};

~~~



file_input的DFA有两个状态，

states_1的定义:

~~~c
static arc arcs_1_0[3] = {
	{2, 0},// a_lbl, a_arrow
	{6, 0},
	{7, 1},
};
static arc arcs_1_1[1] = {
	{0, 1},
};

static state states_1[2] = {
	{3, arcs_1_0},
	{1, arcs_1_1},
};
~~~



~~~c


tic dfa dfas[84] = {
	{256, "single_input", 0, 3, states_0,
	 "\004\050\014\000\000\000\000\025\074\005\023\310\011\020\004\000\300\020\222\006\201"},
	{257, "file_input", 0, 2, states_1,
	 "\204\050\014\000\000\000\000\025\074\005\023\310\011\020\004\000\300\020\222\006\201"},
	{258, "eval_input", 0, 3, states_2,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{259, "decorator", 0, 7, states_3,
	 "\000\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{260, "decorators", 0, 2, states_4,
	 "\000\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{261, "funcdef", 0, 7, states_5,
	 "\000\010\004\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{262, "parameters", 0, 4, states_6,
	 "\000\040\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{263, "varargslist", 0, 10, states_7,
	 "\000\040\010\060\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{264, "fpdef", 0, 4, states_8,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{265, "fplist", 0, 3, states_9,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{266, "stmt", 0, 2, states_10,
	 "\000\050\014\000\000\000\000\025\074\005\023\310\011\020\004\000\300\020\222\006\201"},
	{267, "simple_stmt", 0, 4, states_11,
	 "\000\040\010\000\000\000\000\025\074\005\023\000\000\020\004\000\300\020\222\006\200"},
	{268, "small_stmt", 0, 2, states_12,
	 "\000\040\010\000\000\000\000\025\074\005\023\000\000\020\004\000\300\020\222\006\200"},
	{269, "expr_stmt", 0, 6, states_13,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{270, "augassign", 0, 2, states_14,
	 "\000\000\000\000\000\360\377\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{271, "print_stmt", 0, 9, states_15,
	 "\000\000\000\000\000\000\000\001\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{272, "del_stmt", 0, 3, states_16,
	 "\000\000\000\000\000\000\000\004\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{273, "pass_stmt", 0, 2, states_17,
	 "\000\000\000\000\000\000\000\020\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{274, "flow_stmt", 0, 2, states_18,
	 "\000\000\000\000\000\000\000\000\074\000\000\000\000\000\000\000\000\000\000\000\200"},
	{275, "break_stmt", 0, 2, states_19,
	 "\000\000\000\000\000\000\000\000\004\000\000\000\000\000\000\000\000\000\000\000\000"},
	{276, "continue_stmt", 0, 2, states_20,
	 "\000\000\000\000\000\000\000\000\010\000\000\000\000\000\000\000\000\000\000\000\000"},
	{277, "return_stmt", 0, 3, states_21,
	 "\000\000\000\000\000\000\000\000\020\000\000\000\000\000\000\000\000\000\000\000\000"},
	{278, "yield_stmt", 0, 2, states_22,
	 "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\200"},
	{279, "raise_stmt", 0, 7, states_23,
	 "\000\000\000\000\000\000\000\000\040\000\000\000\000\000\000\000\000\000\000\000\000"},
	{280, "import_stmt", 0, 2, states_24,
	 "\000\000\000\000\000\000\000\000\000\005\000\000\000\000\000\000\000\000\000\000\000"},
	{281, "import_name", 0, 3, states_25,
	 "\000\000\000\000\000\000\000\000\000\001\000\000\000\000\000\000\000\000\000\000\000"},
	{282, "import_from", 0, 8, states_26,
	 "\000\000\000\000\000\000\000\000\000\004\000\000\000\000\000\000\000\000\000\000\000"},
	{283, "import_as_name", 0, 4, states_27,
	 "\000\000\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{284, "dotted_as_name", 0, 4, states_28,
	 "\000\000\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{285, "import_as_names", 0, 3, states_29,
	 "\000\000\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{286, "dotted_as_names", 0, 2, states_30,
	 "\000\000\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{287, "dotted_name", 0, 2, states_31,
	 "\000\000\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{288, "global_stmt", 0, 3, states_32,
	 "\000\000\000\000\000\000\000\000\000\000\001\000\000\000\000\000\000\000\000\000\000"},
	{289, "exec_stmt", 0, 7, states_33,
	 "\000\000\000\000\000\000\000\000\000\000\002\000\000\000\000\000\000\000\000\000\000"},
	{290, "assert_stmt", 0, 5, states_34,
	 "\000\000\000\000\000\000\000\000\000\000\020\000\000\000\000\000\000\000\000\000\000"},
	{291, "compound_stmt", 0, 2, states_35,
	 "\000\010\004\000\000\000\000\000\000\000\000\310\011\000\000\000\000\000\000\000\001"},
	{292, "if_stmt", 0, 8, states_36,
	 "\000\000\000\000\000\000\000\000\000\000\000\010\000\000\000\000\000\000\000\000\000"},
	{293, "while_stmt", 0, 8, states_37,
	 "\000\000\000\000\000\000\000\000\000\000\000\100\000\000\000\000\000\000\000\000\000"},
	{294, "for_stmt", 0, 10, states_38,
	 "\000\000\000\000\000\000\000\000\000\000\000\200\000\000\000\000\000\000\000\000\000"},
	{295, "try_stmt", 0, 13, states_39,
	 "\000\000\000\000\000\000\000\000\000\000\000\000\001\000\000\000\000\000\000\000\000"},
	{296, "with_stmt", 0, 6, states_40,
	 "\000\000\000\000\000\000\000\000\000\000\000\000\010\000\000\000\000\000\000\000\000"},
	{297, "with_var", 0, 3, states_41,
	 "\000\000\010\000\000\000\000\000\000\100\000\000\000\000\000\000\000\000\000\000\000"},
	{298, "except_clause", 0, 5, states_42,
	 "\000\000\000\000\000\000\000\000\000\000\000\000\040\000\000\000\000\000\000\000\000"},
	{299, "suite", 0, 5, states_43,
	 "\004\040\010\000\000\000\000\025\074\005\023\000\000\020\004\000\300\020\222\006\200"},
	{300, "testlist_safe", 0, 5, states_44,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{301, "old_test", 0, 2, states_45,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{302, "old_lambdef", 0, 5, states_46,
	 "\000\000\000\000\000\000\000\000\000\000\000\000\000\020\000\000\000\000\000\000\000"},
	{303, "test", 0, 6, states_47,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{304, "or_test", 0, 2, states_48,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\004\000\300\020\222\006\000"},
	{305, "and_test", 0, 2, states_49,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\004\000\300\020\222\006\000"},
	{306, "not_test", 0, 3, states_50,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\004\000\300\020\222\006\000"},
	{307, "comparison", 0, 2, states_51,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\300\020\222\006\000"},
	{308, "comp_op", 0, 4, states_52,
	 "\000\000\000\000\000\000\000\000\000\000\010\000\000\000\344\037\000\000\000\000\000"},
	{309, "expr", 0, 2, states_53,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\300\020\222\006\000"},
	{310, "xor_expr", 0, 2, states_54,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\300\020\222\006\000"},
	{311, "and_expr", 0, 2, states_55,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\300\020\222\006\000"},
	{312, "shift_expr", 0, 2, states_56,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\300\020\222\006\000"},
	{313, "arith_expr", 0, 2, states_57,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\300\020\222\006\000"},
	{314, "term", 0, 2, states_58,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\300\020\222\006\000"},
	{315, "factor", 0, 3, states_59,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\300\020\222\006\000"},
	{316, "power", 0, 4, states_60,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\222\006\000"},
	{317, "atom", 0, 11, states_61,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\222\006\000"},
	{318, "listmaker", 0, 5, states_62,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{319, "testlist_gexp", 0, 5, states_63,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{320, "lambdef", 0, 5, states_64,
	 "\000\000\000\000\000\000\000\000\000\000\000\000\000\020\000\000\000\000\000\000\000"},
	{321, "trailer", 0, 7, states_65,
	 "\000\040\000\000\000\000\000\000\000\010\000\000\000\000\000\000\000\000\002\000\000"},
	{322, "subscriptlist", 0, 3, states_66,
	 "\000\040\050\000\000\000\000\000\000\010\000\000\000\020\004\000\300\020\222\006\000"},
	{323, "subscript", 0, 7, states_67,
	 "\000\040\050\000\000\000\000\000\000\010\000\000\000\020\004\000\300\020\222\006\000"},
	{324, "sliceop", 0, 3, states_68,
	 "\000\000\040\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{325, "exprlist", 0, 3, states_69,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\000\000\000\300\020\222\006\000"},
	{326, "testlist", 0, 3, states_70,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{327, "dictmaker", 0, 5, states_71,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{328, "classdef", 0, 8, states_72,
	 "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\001"},
	{329, "arglist", 0, 8, states_73,
	 "\000\040\010\060\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{330, "argument", 0, 4, states_74,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{331, "list_iter", 0, 2, states_75,
	 "\000\000\000\000\000\000\000\000\000\000\000\210\000\000\000\000\000\000\000\000\000"},
	{332, "list_for", 0, 6, states_76,
	 "\000\000\000\000\000\000\000\000\000\000\000\200\000\000\000\000\000\000\000\000\000"},
	{333, "list_if", 0, 4, states_77,
	 "\000\000\000\000\000\000\000\000\000\000\000\010\000\000\000\000\000\000\000\000\000"},
	{334, "gen_iter", 0, 2, states_78,
	 "\000\000\000\000\000\000\000\000\000\000\000\210\000\000\000\000\000\000\000\000\000"},
	{335, "gen_for", 0, 6, states_79,
	 "\000\000\000\000\000\000\000\000\000\000\000\200\000\000\000\000\000\000\000\000\000"},
	{336, "gen_if", 0, 4, states_80,
	 "\000\000\000\000\000\000\000\000\000\000\000\010\000\000\000\000\000\000\000\000\000"},
	{337, "testlist1", 0, 2, states_81,
	 "\000\040\010\000\000\000\000\000\000\000\000\000\000\020\004\000\300\020\222\006\000"},
	{338, "encoding_decl", 0, 2, states_82,
	 "\000\000\010\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"},
	{339, "yield_expr", 0, 3, states_83,
	 "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\200"},
};
~~~



关键词的定义

~~~c
static label labels[168] = {
	{0, "EMPTY"},// lb_type, lb_str
	{256, 0},
	{4, 0}, //file input
	{267, 0},
	{291, 0},
	{257, 0},
	{266, 0}, // file input  266 stmt
	{0, 0}, //file input
	{258, 0},
	{326, 0},
	{259, 0},
	{50, 0},
	{287, 0},
	{7, 0},
	{329, 0},
	{8, 0},
	{260, 0},
	{261, 0},
	{1, "def"},
	{1, 0},
	{262, 0},
	{11, 0},
	{299, 0},
	{263, 0},
	{264, 0},
	{22, 0},
	{303, 0},
	{12, 0},
	{16, 0},
	{36, 0},
	{265, 0},
	{268, 0},
	{13, 0},
	{269, 0},
	{271, 0},
	{272, 0},
	{273, 0},
	{274, 0},
	{280, 0},
	{288, 0},
	{289, 0},
	{290, 0},
	{270, 0},
	{339, 0},
	{37, 0},
	{38, 0},
	{39, 0},
	{40, 0},
	{41, 0},
	{42, 0},
	{43, 0},
	{44, 0},
	{45, 0},
	{46, 0},
	{47, 0},
	{49, 0},
	{1, "print"},
	{35, 0},
	{1, "del"},
	{325, 0},
	{1, "pass"},
	{275, 0},
	{276, 0},
	{277, 0},
	{279, 0},
	{278, 0},
	{1, "break"},
	{1, "continue"},
	{1, "return"},
	{1, "raise"},
	{281, 0},
	{282, 0},
	{1, "import"},
	{286, 0},
	{1, "from"},
	{23, 0},
	{285, 0},
	{283, 0},
	{1, "as"},
	{284, 0},
	{1, "global"},
	{1, "exec"},
	{309, 0},
	{1, "in"},
	{1, "assert"},
	{292, 0},
	{293, 0},
	{294, 0},
	{295, 0},
	{296, 0},
	{328, 0},
	{1, "if"},
	{1, "elif"},
	{1, "else"},
	{1, "while"},
	{1, "for"},
	{1, "try"},
	{298, 0},
	{1, "finally"},
	{1, "with"},
	{297, 0},
	{1, "except"},
	{5, 0},
	{6, 0},
	{300, 0},
	{301, 0},
	{304, 0},
	{302, 0},
	{1, "lambda"},
	{320, 0},
	{305, 0},
	{1, "or"},
	{306, 0},
	{1, "and"},
	{1, "not"},
	{307, 0},
	{308, 0},
	{20, 0},
	{21, 0},
	{28, 0},
	{31, 0},
	{30, 0},
	{29, 0},
	{29, 0},
	{1, "is"},
	{310, 0},
	{18, 0},
	{311, 0},
	{33, 0},
	{312, 0},
	{19, 0},
	{313, 0},
	{34, 0},
	{314, 0},
	{14, 0},
	{15, 0},
	{315, 0},
	{17, 0},
	{24, 0},
	{48, 0},
	{32, 0},
	{316, 0},
	{317, 0},
	{321, 0},
	{319, 0},
	{9, 0},
	{318, 0},
	{10, 0},
	{26, 0},
	{327, 0},
	{27, 0},
	{25, 0},
	{337, 0},
	{2, 0},
	{3, 0},
	{332, 0},
	{335, 0},
	{322, 0},
	{323, 0},
	{324, 0},
	{1, "class"},
	{330, 0},
	{331, 0},
	{333, 0},
	{334, 0},
	{336, 0},
	{338, 0},
	{1, "yield"},
};
~~~



#### labels

~~~c
#define single_input 256
#define file_input 257
#define eval_input 258
#define decorator 259
#define decorators 260
#define funcdef 261
#define parameters 262
#define varargslist 263
#define fpdef 264
#define fplist 265
#define stmt 266
#define simple_stmt 267
#define small_stmt 268
#define expr_stmt 269
#define augassign 270
#define print_stmt 271
#define del_stmt 272
#define pass_stmt 273
#define flow_stmt 274
#define break_stmt 275
#define continue_stmt 276
#define return_stmt 277
#define yield_stmt 278
#define raise_stmt 279
#define import_stmt 280
#define import_name 281
#define import_from 282
#define import_as_name 283
#define dotted_as_name 284
#define import_as_names 285
#define dotted_as_names 286
#define dotted_name 287
#define global_stmt 288
#define exec_stmt 289
#define assert_stmt 290
#define compound_stmt 291
#define if_stmt 292
#define while_stmt 293
#define for_stmt 294
#define try_stmt 295
#define with_stmt 296
#define with_var 297
#define except_clause 298
#define suite 299
#define testlist_safe 300
#define old_test 301
#define old_lambdef 302
#define test 303
#define or_test 304
#define and_test 305
#define not_test 306
#define comparison 307
#define comp_op 308
#define expr 309
#define xor_expr 310
#define and_expr 311
#define shift_expr 312
#define arith_expr 313
#define term 314
#define factor 315
#define power 316
#define atom 317
#define listmaker 318
#define testlist_gexp 319
#define lambdef 320
#define trailer 321
#define subscriptlist 322
#define subscript 323
#define sliceop 324
#define exprlist 325
#define testlist 326
#define dictmaker 327
#define classdef 328
#define arglist 329
#define argument 330
#define list_iter 331
#define list_for 332
#define list_if 333
#define gen_iter 334
#define gen_for 335
#define gen_if 336
#define testlist1 337
#define encoding_decl 338
#define yield_expr 339

~~~

