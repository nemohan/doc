# 超卖问题

假如现在某网站上卖一件商品，如何避免卖出超过库存数量的商品呢？

### 加互斥锁

通过加互斥锁的方式，使得同一时刻只有一笔交易可以访问商品库存，其他的交易只能等待当前交易完成后，才能继续。

| 时间 | 操作                                             |      |
| ---- | ------------------------------------------------ | ---- |
| t1   | select stock from product where id=5 for update; |      |
| t2   | 检查stock是否大于0                               |      |
| t3   | 若stock大于0，更新库存。交易成功                 |      |

