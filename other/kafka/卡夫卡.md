# kafka

kafka的消息队列以主题(topic)-分区(partition)的形式呈现,每个主题包含若干个分区

### 生产者



分区:

消息发送方式:

* fire-and-forget

* 同步
* 异步

### 消费者

##### 订阅消息

一般情况下，消费者通过加入消费者群组订阅某个主题。第一个加入群组的消费者是群主，群主会以某种策略来确定哪个消费者负责哪个分区。

消费者加入或离开会导致分区再均衡，即新加入的消费者会接管部分其他消费者负责的分区；消费者退出后，其负责的分区将分配给其他消费者

<font color="red">注意：<<kafka权威指南>>书中提到，消费者数量超过分区数量会导致剩余的消费者闲置。问题是一个群组中的消费者数量超过分区数量，还是多个群组总的消费者数量超过分区数量</font>

##### 获取消息

消费者通过轮询获取消息，轮询期间消费者会处理诸如心跳、再均衡等情况



##### 消费者属性设置



##### 提交偏移量

默认情况下，消费者读取消息之后，会自动提交偏移量到分区。偏移量标记着当前分区正在处理的消息的位置。设置偏移量可以尽量避免消息的重复处理。除自动提交之外也可以手动提交。

手动提交有两种方式:

* 同步提交 
* 异步提交

分区分配策略:

* range
* roundRobin



##### <font color="red">疑问</font>

1 多个消费者群组订阅一个主题，那么每个消费者群组会收到同一条消息么

2 消费者群主决定哪个消费者负责哪个分区，会出现属于不同群组的消费者共享一个分区的情况么？？